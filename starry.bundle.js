(()=>{"use strict";var e="./";const t=e+"assets/image/star.png",n=e+"assets/audio/给你宇宙.mp3",o=e+"assets/audio/shootingStar.mp3",s=e+"assets/audio/click.mp3",l=e+"assets/image/purpleStar.png",i=e+"assets/image/sky.png",a=e+"assets/image/moon.png",r=e+"assets/image/animate-earth.gif";document.querySelector(".easterEgg").src=l,document.querySelector(".sky").src=i,document.querySelector(".moon").src=a,document.querySelector(".earth-container").src=r;const c=new Audio(n),d=new Audio(o),y=new Audio(s);d.volume=.5,d.preload="auto",d.loop=!0,y.volume=.5,y.preload="auto",window.addEventListener("load",()=>{const e=document.querySelector(".overlay");e.classList.add("fade-in"),setTimeout(()=>{e.style.display="none"},3e3)});const u=document.getElementById("lineCanvas"),p=u.getContext("2d"),m=document.getElementById("starsContainer"),h=document.querySelector(".tip"),f=document.querySelector(".shadow");let g=!1,x=!1;function v(){u.width=window.innerWidth,u.height=window.innerHeight}v(),window.addEventListener("resize",()=>{v(),q()});const E=6,w=[],k=[],L=[{x:1400,y:300},{x:1180,y:270},{x:1130,y:520},{x:1500,y:750},{x:1720,y:450},{x:1630,y:220}];function S(e,n,o){const s=document.createElement("img");return s.className="star",s.src=t,s.alt="星星",s.style.width=`${o}px`,s.style.height=`${o}px`,s.style.left=`${e}px`,s.style.top=`${n}px`,s}function C(e,t,n){const o=n+30;return w.some(n=>{if(n.isHeartKey){const s=e-n.x,l=t-n.y;return Math.sqrt(s*s+l*l)<o}return!1})}function b(e){k.push(e),k.length>=2&&M(k[k.length-2],k[k.length-1])}function M(e,t){const n=e.x+e.size/2,o=e.y+e.size/2,s=t.x+t.size/2,l=t.y+t.size/2;p.beginPath(),p.moveTo(n,o),p.lineTo(s,l),p.strokeStyle="#ffd700",p.lineWidth=3,p.lineCap="round",p.stroke()}function q(){p.clearRect(0,0,u.width,u.height);for(let e=1;e<k.length;e++)M(k[e-1],k[e]);if(k.length===E){const e=w.find(e=>e.isHeartKey&&0===e.heartIndex);e&&M(k[E-1],e)}}function $(e,t=!1){h.textContent=e,t&&(h.classList.add("error-tip"),setTimeout(()=>{h.classList.remove("error-tip"),h.innerHTML=""},2e3))}!function(){for(let e=0;e<E;e++){const t=Math.floor(31*Math.random())+60,n=L[e],o=n.x,s=n.y,l=S(o,s,t),i={x:o,y:s,size:t,element:l,isHeartKey:!0,heartIndex:e};w.push(i),m.appendChild(l)}const e=15-E;for(let t=0;t<e;t++){const e=Math.floor(31*Math.random())+60;let t,n;do{const o=(window.innerWidth-500)/2;t=o+Math.random()*(window.innerWidth-o-e),n=Math.random()*(.9*window.innerHeight-e)}while(C(t,n,e));const o=S(t,n,e),s={x:t,y:n,size:e,element:o,isHeartKey:!1,heartIndex:-1};w.push(s),m.appendChild(o)}w.forEach(e=>{e.element.addEventListener("click",()=>function(e){if(g)return;if($(""),k.length>0&&k[k.length-1]===e)return k.pop().element.classList.remove("active"),q(),void(0===k.length&&$("不是起点！"));if(k.includes(e)&&(k.length!==E||0!==e.heartIndex))return void $("不可重复点击已连线的星星！",!0);if(0===k.length)return void(e.isHeartKey&&0===e.heartIndex?b(e):e.isHeartKey||$("点错啦",!0));if(k.length===E)return void(e.isHeartKey&&0===e.heartIndex?(M(k[k.length-1],e),$("🎉 连线完成！"),function(){g=!0;const e=w.filter(e=>e.isHeartKey);e.forEach(e=>{e.element.classList.add("blinking")}),p.strokeStyle="#ffd700",p.lineWidth=3,p.lineCap="round",q(),c.currentTime=0,c.play().catch(e=>{console.log("音乐播放失败:",e),$("请点击页面以播放音乐",!0)}),setTimeout(()=>{e.forEach(e=>{e.element.classList.remove("blinking")}),g=!1},3e3),c.onended=function(){!function(){g=!1,c.onended=null;const e=w.filter(e=>e.isHeartKey);e.forEach(e=>{e.element.classList.remove("blinking")}),k.length=0,q()}()}}()):$("点错啦！",!0));const t=k[k.length-1].heartIndex+1;e.isHeartKey?e.heartIndex===t?b(e):$("顺序错啦！",!0):$("点错啦！",!0)}(e))})}();const T=document.querySelector(".number1"),I=document.querySelector(".easterEgg1");function H(){I.style.display="none",f.style.display="none",x=!1,d.pause(),d.currentTime=0,clearTimeout(P),d.onended=null,document.removeEventListener("click",H)}let P=null;function z(){d.currentTime=0,d.play().catch(e=>{console.log("音效播放失败:",e)}),d.onended=function(){x&&(P=setTimeout(z,500))}}T.addEventListener("click",e=>{e.stopPropagation(),x||(I.style.display="flex",f.style.display="block",x=!0,z(),document.addEventListener("click",H))});const K=document.querySelector(".easterEgg.number2"),N=document.querySelector(".easterEgg2"),W=document.querySelector(".doodle-container"),A=document.querySelector(".doodle-text"),B=document.querySelector(".doodle-close");let F=!1,R=0,X=0;const Y=[],O=[];function j(e,t){const n=document.createElement("div");n.style.position="absolute",n.style.width="8px",n.style.height="8px",n.style.backgroundColor="#ffd700",n.style.borderRadius="50%",n.style.left=`${e}px`,n.style.top=`${t}px`,n.style.opacity="0.7",n.style.boxShadow="0 0 8px #ffd700, 0 0 16px #ffd700",n.style.transition="opacity 0.6s ease-out, transform 0.6s ease-out",W.appendChild(n),O.push(n),setTimeout(()=>{n.style.opacity="0",n.style.transform="scale(0.4)",setTimeout(()=>{n.remove();const e=O.indexOf(n);e>-1&&O.splice(e,1)},600)},300)}function D(e,t){const n=document.createElement("div");return n.style.position="absolute",n.style.width="10px",n.style.height="10px",n.style.backgroundColor="#ffd700",n.style.borderRadius="50%",n.style.left=`${e}px`,n.style.top=`${t}px`,n.style.opacity="0",n.style.boxShadow="0 0 12px #ffd700, 0 0 24px #ffd700",n.style.transition="opacity 0.3s ease, transform 0.3s ease",W.appendChild(n),n}function G(){N.style.display="none",f.style.display="none",Y.forEach(e=>e.remove()),Y.length=0,O.forEach(e=>e.remove()),O.length=0}N.style.display="none",W.addEventListener("mousedown",e=>{F=!0,R=e.clientX,X=e.clientY,Y.length=0,O.forEach(e=>e.remove()),O.length=0,j(R,X);const t=D(R,X);Y.push(t)}),W.addEventListener("mousemove",e=>{if(!F)return;const t=e.clientX,n=e.clientY;if(Math.sqrt(Math.pow(t-R,2)+Math.pow(n-X,2))>5){j(t,n);const e=D(t,n);Y.push(e),R=t,X=n}}),W.addEventListener("mouseup",()=>{F=!1,A.style.opacity="0.9",A.textContent="你划过的轨迹，是独属于你的星空印记",O.forEach(e=>{e.style.opacity="0",e.style.transform="scale(0.4)",setTimeout(()=>e.remove(),300)}),O.length=0,Y.forEach((e,t)=>{setTimeout(()=>{e.style.opacity="1",e.style.transform="scale(1.2)"},15*t)})}),K.addEventListener("click",e=>{console.log("点击了彩蛋2"),e.stopPropagation(),"block"===N.style.display?G():(N.style.display="block",f.style.display="block",A.textContent="",A.textContent="拖动鼠标绘制星轨 ✨")}),B.addEventListener("click",e=>{e.stopPropagation(),G()}),f.addEventListener("click",()=>{"block"===N.style.display&&G()});const J=document.querySelector(".easterEgg.number3"),Q=document.querySelector(".easterEgg3"),U=document.querySelector(".constellation-container"),V=document.querySelector(".constellation-time"),Z=document.querySelector(".constellation-text");let _=0,ee=null,te=10;function ne(){const e=document.createElement("div");let t,n;e.className="constellation-distractor";do{t=Math.random()*(window.innerWidth-40)+20,n=Math.random()*(window.innerHeight-40)+20}while(oe(t,n));e.style.left=`${t}px`,e.style.top=`${n}px`,e.addEventListener("click",e=>{e.stopPropagation(),V.textContent="❌ 不是目标碎片！",V.style.color="#ff4444",y.currentTime=0,y.play().catch(e=>console.log("音效播放失败:",e)),setTimeout(()=>{V.textContent=`剩余时间：${te}s`,V.style.color="#ff4444"},800)}),U.appendChild(e)}function oe(e,t){const n=document.querySelectorAll(".constellation-fragment");return 0!==n.length&&Array.from(n).some(n=>{const o=parseFloat(n.style.left)||0,s=parseFloat(n.style.top)||0;return Math.sqrt(Math.pow(e-o,2)+Math.pow(t-s,2))<60})}function se(){const e=document.createElement("div");e.className="constellation-fragment";const t=Math.random()*(window.innerWidth-40)+20,n=Math.random()*(window.innerHeight-40)+20;e.style.left=`${t}px`,e.style.top=`${n}px`,e.addEventListener("click",o=>{o.stopPropagation(),o.stopImmediatePropagation(),y.currentTime=0,y.play().catch(e=>console.log("音效播放失败:",e)),function(e,t){for(let n=0;n<8;n++){const n=document.createElement("div");n.className="constellation-particle";const o=6*Math.random()+2;n.style.width=`${o}px`,n.style.height=`${o}px`,n.style.left=`${e}px`,n.style.top=`${t}px`,n.style.opacity="0.8";const s=Math.random()*Math.PI*2,l=10*Math.random()+5;n.style.transform=`translate(${Math.cos(s)*l}px, ${Math.sin(s)*l}px)`,n.style.transition="opacity 0.5s ease, transform 0.5s ease",U.appendChild(n),setTimeout(()=>{n.style.opacity="0",setTimeout(()=>n.remove(),500)},300)}}(t,n),e.style.animation="pulse 0.5s",setTimeout(()=>{e.style.opacity="0",e.style.transform="scale(0)"},200),_++,V.textContent=`✅ 找到${_}/3个碎片！`,V.style.color="#4CAF50",3===_?(clearInterval(ee),V.style.opacity="0",function(){const e=.5*window.innerWidth,t=.5*window.innerHeight,n=[{x:e-120,y:t-60},{x:e-60,y:t-30},{x:e,y:t},{x:e+60,y:t-30},{x:e+120,y:t-60},{x:e-60,y:t+60},{x:e+60,y:t+60}],o=document.createElement("div");o.className="orion-constellation",U.appendChild(o),n.forEach((e,t)=>{if(t<n.length-1){const s=n[t+1],l=document.createElement("div");l.className="orion-line",l.style.left=`${e.x}px`,l.style.top=`${e.y}px`;const i=Math.sqrt(Math.pow(s.x-e.x,2)+Math.pow(s.y-e.y,2)),a=180*Math.atan2(s.y-e.y,s.x-e.x)/Math.PI;l.style.width=`${i}px`,l.style.transform=`rotate(${a}deg)`,o.appendChild(l),setTimeout(()=>{l.style.opacity="1"},300*t)}})}(),Z.style.opacity="1",Z.classList.add("blinking")):setTimeout(()=>{V.textContent=`剩余时间：${te}s`,V.style.color="#ff4444"},800)}),U.appendChild(e)}function le(){U.innerHTML="",_=0,te=10,V.textContent=`剩余时间：${te}s`,V.style.opacity="0.9",V.style.color="#ff4444",V.style.fontSize="20px",V.classList.remove("blinking"),Z.style.opacity="0",function(){const e=document.createElement("div");e.className="constellation-bg",U.appendChild(e)}(),function(){const e=document.createElement("div");e.className="constellation-hint",e.textContent="找一找：3颗闪烁的蓝色亮星",U.appendChild(e)}();for(let e=0;e<3;e++)se();for(let e=0;e<12;e++)ne();clearInterval(ee),ee=setInterval(()=>{te--,V.textContent=`剩余时间：${te}s`,te<=5?(V.style.fontSize="22px",V.classList.add("blinking")):(V.style.fontSize="20px",V.classList.remove("blinking")),te<=0&&(clearInterval(ee),V.classList.remove("blinking"),V.textContent="⏰ 时间到！点击此处再试一次～",V.style.cursor="pointer")},1e3)}Q.style.display="none",V.addEventListener("click",()=>{(te<=0||3===_)&&le()}),J.addEventListener("click",e=>{e.stopPropagation(),"block"===Q.style.display?(Q.style.display="none",f.style.display="none",clearInterval(ee)):(Q.style.display="block",f.style.display="block",f.style.opacity="0.8",le())}),document.querySelector(".doodle-close3").addEventListener("click",e=>{e.stopPropagation(),Q.style.display="none",f.style.display="none",clearInterval(ee)});const ie=document.querySelector(".exitPopup");document.querySelector(".right").addEventListener("click",()=>{ie.style.display="none"}),document.querySelector(".moon").addEventListener("click",()=>{ie.style.display="block"}),document.getElementById("confirmExit").addEventListener("click",()=>{window.close()}),document.getElementById("cancelExit").addEventListener("click",()=>{ie.style.display="none"})})();