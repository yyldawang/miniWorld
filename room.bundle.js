(()=>{"use strict";var e="./";const t=e+"assets/audio/clap.mp3",s=e+"assets/audio/windBell.mp3",o=e+"assets/audio/switch.mp3",n=e+"assets/audio/mosquito.mp3",a=e+"assets/image/mosquito.png",c=e+"assets/image/switch.png",l=e+"assets/image/bg.png",i=e+"assets/image/windbell.png",r=e+"assets/image/we.jpg",d=e+"assets/image/Castle.png";document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".switch");e&&(e.src=c);const u=document.querySelector(".bg");u&&(u.src=l);const m=document.querySelector(".windbell");m&&(m.src=i);const p=document.querySelector(".left img");p&&(p.src=r);const y=document.querySelector(".castle");y&&(y.src=d),function(){const e=document.querySelector(".container"),c=document.querySelector(".tip"),l=document.querySelector(".windbell");let i=null,r=null,d=!1;const u=new Audio(t);u.preload="auto",u.volume=.5;const m=new Audio(s);m.preload="auto",m.volume=.5;const p=new Audio(o);p.preload="auto",p.volume=.5;const y=new Audio(n);function g(){u.currentTime=0,u.play().catch(e=>{console.log("音效播放失败：",e)})}function h(){d=!0,i=document.createElement("img"),i.src=a,i.alt="蚊子",i.className="mosquito";const t=e.offsetWidth,s=e.offsetHeight,o=Math.random()*(t-50),n=Math.random()*(s-50);i.style.left=`${o}px`,i.style.top=`${n}px`,e.appendChild(i),y.currentTime=0,y.play().catch(e=>{console.log("音效播放失败：",e)}),i.addEventListener("click",t=>{g(),y.pause(),y.currentTime=0,t.stopPropagation(),clearInterval(r),setTimeout(()=>{c.style.display="block"},700),setTimeout(()=>{c.style.display="none",e.contains(i)&&e.removeChild(i),i=null,d=!1,l.classList.remove("disabled")},2e3)}),r=setInterval(()=>{!function(){if(!i)return;const t=e.offsetWidth,s=e.offsetHeight,o=i.offsetWidth,n=i.offsetHeight,a=parseFloat(i.style.left),c=parseFloat(i.style.top);let l=80*(Math.random()-.5),r=80*(Math.random()-.5),d=a+l,u=c+r;(d<=0||d>=t-o)&&(d=Math.max(0,Math.min(d,t-o)),l=-l),(u<=0||u>=s-n)&&(u=Math.max(0,Math.min(u,s-n)),r=-r),i.style.left=`${d}px`,i.style.top=`${u}px`,i.style.transform=Math.random()>.5?"scaleX(1)":"scaleX(-1)"}()},100),l.classList.add("disabled"),d=!1}y.preload="auto",y.volume=.5,y.loop=!0,e.addEventListener("click",t=>{const s=e.offsetWidth,o=t.clientX;i&&g();const n=l.classList.contains("swing");o<=.3*s&&!i&&!n&&!d&&h()}),l.addEventListener("click",()=>{l.classList.contains("swing")||(l.classList.add("swing"),m.currentTime=0,m.play().catch(e=>{console.log("音效播放失败：",e)}),setTimeout(()=>{l.classList.remove("swing"),c.style.display="none",i&&e.contains(i)&&(y.pause(),y.currentTime=0,e.removeChild(i),i=null,d=!1,clearInterval(r),l.classList.remove("disabled"))},3e3))});const v=document.querySelector(".castlePopup"),f=document.querySelector(".mask"),w=document.querySelector(".castle"),L=document.querySelector(".icon");w.addEventListener("click",e=>{e.stopPropagation(),v.classList.toggle("show"),f.classList.toggle("show")}),L.addEventListener("click",()=>{v.classList.remove("show"),f.classList.remove("show")}),f.addEventListener("click",()=>{v.classList.remove("show"),f.classList.remove("show")});const S=document.querySelector(".switch"),q=document.querySelector(".switchPopup"),k=document.querySelector(".switchConfirm"),E=document.querySelector(".switchInput");function M(){const e=E.value.trim();if(!/^([01]\d|2[0-3]):([0-5]\d)$/.test(e))return alert("请输入正确的时间格式（例如：19:00）"),!1;const t=new Date;if(e===`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`){q.style.display="none",E.value="";const e=document.querySelector(".overlay");return e.style.display="block",e.classList.add("fade-out"),setTimeout(()=>{window.location.href="./starry.html"},3e3),!0}return alert("时间不正确，请重新输入！"),!1}S.addEventListener("click",e=>{e.stopPropagation(),p.currentTime=0,p.play().catch(e=>{console.log("音效播放失败：",e)}),q.style.display="flex"}),document.addEventListener("click",e=>{q.contains(e.target)||(q.style.display="none",E.value="")}),k.addEventListener("click",e=>{e.stopPropagation(),M()}),E.addEventListener("keydown",e=>{"Enter"===e.key&&M()}),q.addEventListener("click",e=>{e.stopPropagation()})}()}),window.addEventListener("load",()=>{const e=document.querySelector(".overlay");e.classList.add("fade-in"),setTimeout(()=>{e.style.display="none"},3e3)})})();